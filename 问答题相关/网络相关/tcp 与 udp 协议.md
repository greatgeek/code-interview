# 网络相关内容

## 基础网络概念

### OSI 模型的七层：

1. 物理层
2. 链路层
3. 网络层
4. 传输层
5. 会话层
6. 表示层
7. 应用层

### 什么是 TCP的三次握手？

三次握手是 TCP 连接建立的过程。

1. SYN：先由客户端发送 SYN 包，询问是否可以打开连接；
2. SYN+ACK：服务器回应 SYN+ACK 包，确认它收到了 SYN；
3. ACK：最后客户端再回应 ACK 包，确认它收到了 SYN-ACK。此时连接已建立。

### TCP 与 UDP 的主要区别？

* 连接性：TCP 是面向连接的，意味着通信双方必须先建立连接后才能传输数据。而 UDP 是无连接的，它只是简单地发送数据包。
* 可靠性：TCP 提供了数据传输的可靠，通过使用 ACKs、重传、流量控制等机制。而 UDP 不保证数据的可靠传输。
* 顺序：TCP 保证数据的顺序传输，UDP 则可能会出现数据包乱序。
* 速度：由于 UDP 少了很多 TCP 的错误检查和排序机制，所以它比 TCP 更快。
* 用途：TCP 通常用于需要高可靠性的应用，如 Web 服务器、文件传输等。UDP 常用于如 VoIP、视频流等对速度要求高、可容忍少量丢包的应用。

### 描述一个网络中的 NAT 是如何工作的？

NAT（网络地址转换）允许一个私有 IP 地址在公共网络上使用一个公共 IP 地址进行通信。它修改 IP 数据包头中的源/目的地址。

#### 详细说明一下 docker 中的 NAT 是如何工作的？

Docker 中的 NAT（网络地址转换）主要涉及 Docker 的默认网络模式，也就是 bridge 模式。当你在 Docker 中运行一个容器而不指定任何网络设置时，它默认使用 bridge 模式。在这种模式下，Docker 容器具有其自己的私有 IP 地址，这个地址与宿主机是隔离的。但要让这些容器能够与外界通信，Docker 会使用 NAT 技术。

1. 私有 IP 地址：每个 Docker 容器都会从一个私有的 IP 地址池中分配到一个 IP 地址。
2. Docker Bridge：Docker 守护进程会创建一个名为`docker0`的虚拟网桥。所有未指定网络模式的容器都会连接到这个 bridge。
3. NAT 与 Port Mapping：
   * 当你希望外部访问到容器的某个服务时，你会指定一个端口映射，例如`8080:80`，表示将容器的 80 端口映射到宿主机的 8080 端口。
   * 当外部流量到达宿主机的 8080 端口时，Docker 会使用 NAT 技术将这些流量转发到容器的 80 端口。
4. Iptables 规则：
   * Docker 会自动为端口映射和 NAT 更新宿主机的 iptables 规则。这些规则会确保进入宿主机的流量正确地路由到相应的容器，并确保容器的出站流量正确地路由出去。
5. 本机容器间通信：
   * 容器间的通信也是通过`docker0` bridge 实现的。由于它们都在同一个网络内，所以容器之间可以使用私有 IP 地址直接通信。
6. 跨主机容器通信：
   * 对于向外部世界的通信，容器的出站流量会伪装成来自宿主机的流量。这是通过源 NAT（SNAT）实现的，它会将数据包的源 IP 地址更改为宿主机的 IP 地址。

总之，Docker 使用 NAT 技术，确保容器能够与外部世界通信，同时仍然保持隔离。这为容器提供了一个额外的安全层，因为你可以控制哪些端口是对外部世界开放的，而哪些是关闭的。